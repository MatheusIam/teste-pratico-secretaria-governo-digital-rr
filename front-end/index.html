<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link rel="stylesheet" href="css/meucss.css">
    <title>Cadastro de usuários</title>
</head>

<body>
    <div class="container-md">
        <!-- Botão novo -->
        <div class="row">
            <div class="col-1">
                <button type="button" id="btn-novo">Novo</button>
            </div>
        </div>
    </div>

    <div class="container-md">
        <!-- Tabela -->

        <table class="table table-bordered">
            <!-- Cabeça da tabela -->
            <thead>
                <tr>
                    <th scope="col">Id</th>
                    <th scope="col">CPF</th>
                    <th scope="col">Data de Nascimento</th>
                    <th scope="col">Nome</th>
                    <th scope="col">Sexo</th>
                    <th scope="col">Ações</th>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
        <script>
            window.addEventListener('load', function () {
                fetch('http://127.0.0.1:8080/usuarios')
                    .then(response => response.json()) // Baixa o JSON do endpoint GET
                    .then(dados => {
                        const tableBody = document.querySelector('tbody');

                        // Criação da tabela, cada botão tem um ID do usuário correspondente a linha dele
                        dados.forEach(usuario => {
                            const linha = document.createElement('tr');
                            linha.innerHTML = `
                                <th scope="row">${usuario.id}</th>
                                <td>${usuario.cpf}</td>
                                <td>${usuario.dataNascimento ? usuario.dataNascimento.split('-').reverse().join('/') : ''}</td> 
                                <td class="nome">${usuario.nome}</td>
                                <td>${usuario.sexo}</td>
                                <td><button type="button" class="btn-excluir" id="${usuario.id}">E</button><button type="button" class="btn-alterar" id="${usuario.id}"">A</button></td>
                            `;
                            tableBody.appendChild(linha); // incrementa mais 1 linha
                        });
                    });
            });
        </script>
    </div>

    <script>
        document.querySelector('#btn-novo').addEventListener('click', function () {
            location.assign('novo.html');
        });

        document.addEventListener('click', function (event) {
            if (event.target.matches('.btn-excluir')) {
                const id = event.target.id;
                fetch(`http://localhost:8080/usuarios/${id}`, {
                    method: 'DELETE'
                });
                location.reload();
            }
        });

        document.addEventListener('click', function (event) {
            if (event.target.matches('.btn-alterar')) {
                const id = event.target.id;
                window.location.href = `alterar.html?id=${id}`;
            }
        });


    </script>
</body>

</html>